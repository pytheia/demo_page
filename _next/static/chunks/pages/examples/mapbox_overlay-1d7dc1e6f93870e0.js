(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[151],{3454:function(e,t,n){"use strict";var r,o;e.exports=(null===(r=n.g.process)||void 0===r?void 0:r.env)&&"object"===typeof(null===(o=n.g.process)||void 0===o?void 0:o.env)?n.g.process:n(7663)},2211:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/examples/mapbox_overlay",function(){return n(4053)}])},4053:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var r=n(4051),o=n.n(r),a=n(5893),i=n(7294),s=n(6158),u=n.n(s),c=n(602);function l(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,o)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){l(a,r,o,i,s,"next",e)}function s(e){l(a,r,o,i,s,"throw",e)}i(void 0)}))}}var d="http://136.55.47.219:8080/graphql/",h=function(){var e=f(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(d,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:"query videos($video_name: String!) {\n        videos(name: $video_name) {\n            name\n            location\n            fps\n            frame_count\n        }\n    }",variables:{video_name:t}})}).then((function(e){return e.json()})).then((function(e){return[e.data.videos.frame_count,e.data.videos.fps]})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=f(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(d,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:"query video_tracks_query($video_name: String!) {\n        video_tracks(video: $video_name) {\n            id\n            ds_id\n            class_field\n        }\n    }",variables:{video_name:t}})}).then((function(e){return e.json()})).then((function(e){return e.data.video_tracks})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=f(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(d,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:"query track_estimates_query($track_id: ID!) {\n        track_estimates(track_id: $track_id) {\n            id\n            x\n            y\n            theta\n            vx\n            vy\n            l\n            w\n            prob_exists\n            time\n        }\n    }",variables:{track_id:t}})}).then((function(e){return e.json()})).then((function(e){return e.data.track_estimates})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();!function(){var e=f(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(d,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:"query geo_track_estimates_query($track_id: ID!) {\n        geo_track_estimates(track_id: $track_id) {\n            id\n            lat\n            lon\n            time\n        }\n    }",variables:{track_id:t}})}).then((function(e){return e.json()})).then((function(e){return e.data.geo_track_estimates})));case 1:case"end":return e.stop()}}),e)})))}();var m=Math.PI/180,g=Math.PI,y=-90*m,w=function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.class=r,this.image=new Image,this.image.src=t,this.width=Math.round(o*n),this.height=this.image.height/this.image.width*this.width,this.k_res=o},_="#9B2729",b=["#168D6D","#EFA8A1","#6D59F4","#D16B23","#01B4D7","#8E0072","#168D6D","#EFA8A1","#6D59F4","#D16B23","#01B4D7","#8E0072"],T="#F13433",k=function(e,t,n,r){return-r/(n-t)*(e-t)+r};function x(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#9B2729",s=2*a,u=o*Math.cos(r-g/2),c=o*Math.sin(r-g/2),l=t+u,f=n+c;r=Math.atan2(f-n,l-t);e.save(),e.strokeStyle=i,e.globalAlpha=1,e.shadowColor=i,e.shadowBlur=5,e.beginPath(),e.moveTo(t,n),e.lineTo(l,f),e.lineWidth=a,e.stroke(),e.globalAlpha=1,e.beginPath(),e.moveTo(l,f),e.lineTo(l-s*Math.cos(r-Math.PI/7),f-s*Math.sin(r-Math.PI/7)),e.lineTo(l-s*Math.cos(r+Math.PI/7),f-s*Math.sin(r+Math.PI/7)),e.lineTo(l,f),e.lineTo(l-s*Math.cos(r-Math.PI/7),f-s*Math.sin(r-Math.PI/7)),e.stroke(),e.restore()}function I(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,o=new Image;o.src="/alert_1.png",e.save(),e.shadowColor=T,e.shadowBlur=20,e.globalAlpha=.7,e.translate(t,n),e.drawImage(o,-Math.round(r/2),-Math.round(r/2),r,r),e.restore()}function S(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16;e.save(),e.shadowBlur=0,e.shadowColor="#AFAFAF",e.beginPath(),e.strokeStyle=_,e.globalAlpha=.7,e.fillStyle="#AFAFAF",e.lineWidth=3,e.arc(t,n,o,0,2*g),e.fill(),e.stroke(),e.fillStyle="black",e.font="bold "+o+"px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(r,t,n),e.restore()}function M(e,t,n,r,o,a){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=arguments.length>9&&void 0!==arguments[9]&&arguments[9],l=arguments.length>10&&void 0!==arguments[10]&&arguments[10],f=.7*a.k_res;f<15&&(f=15),f>30&&(f=30);var d=a.image,h=a.width,p=a.height,v=.05*i*50;if(i<7&&i>=0?v=7:i>-7&&i<0&&(v=-7),e.save(),e.translate(t,n),e.rotate(r),e.globalAlpha=.8,e.shadowColor=o,e.shadowBlur=s?0:8,e.drawImage(d,-h/2,-p/2,h,p),e.strokeStyle=o,u&&(s?(e.lineWidth=5,e.shadowBlur=0):(e.lineWidth=2,e.shadowBlur=10),e.beginPath(),e.rect(-h/2,-p/2,h,p),e.stroke()),c&&(l?x(e,0,-f,0,v):x(e,0,0,0,v,.06*v)),e.restore(),l&&!s&&S(e,t,n,i,f),s){var m=2*a.k_res;I(e,t,n,m)}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,o)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){E(a,r,o,i,s,"next",e)}function s(e){E(a,r,o,i,s,"throw",e)}i(void 0)}))}}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(u){s=!0,o=u}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}u().accessToken="pk.eyJ1IjoicHl0aGVpYSIsImEiOiJjbDQxcWlhemE0YmdkM2RsOHBseG00b3RnIn0.987d1_G_xmVSzyZ8UEn3Zg";var O=[-84.38319790131492,33.78648826571573,295.4699674848657],C=[0,100],F=[-15,20],D=[-84.38341384065934,33.78738978611776],q=[-84.38303594680659,33.78738978620043],B=[-84.38303594850376,33.78648826560946],$=[-84.38341383839648,33.78648826552679],N="atl_906_2.mp4",L=function(){var e=(0,i.useRef)(null),t=(0,i.useRef)(null),n=(0,i.useRef)(null),r=(0,i.useState)(1),s=r[0],l=r[1],f=(0,i.useState)(1),d=f[0],m=f[1],g=(0,i.useState)(0),_=g[0],T=g[1],x=(0,i.useState)(O[0]),I=x[0],S=(x[1],(0,i.useState)(O[1])),A=S[0],E=(S[1],(0,i.useState)()),L=E[0],J=E[1],R=(0,i.useState)(),W=R[0],Z=R[1],G=(0,i.useState)(),z=G[0],H=G[1],U=(0,i.useState)(0),V=U[0],X=U[1],Y=(0,i.useState)(0),Q=Y[0],K=Y[1],ee=(0,i.useState)(0),te=ee[0],ne=ee[1],re=(0,i.useState)(!1),oe=re[0],ae=re[1];return(0,i.useEffect)((function(){n.current=new(u().Map)({container:e.current,style:"mapbox://styles/pytheia/cl48njcgw004015nv3w1njmuf",center:[I,A],zoom:17.5});var t=n.current;t.on("load",(function(){ae(!0),t.addSource("canvas",{type:"canvas",canvas:"canvasID",coordinates:[D,q,B,$],animate:!0}),t.addLayer({id:"canvas-layer",type:"raster",source:"canvas"})})),j(o().mark((function e(){var t,n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=P,e.next=3,h(N);case 3:e.t1=e.sent,t=(0,e.t0)(e.t1,2),n=t[0],r=t[1],l(n),m(r);case 9:case"end":return e.stop()}}),e)})))(),j(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(N);case 2:return t=e.sent,e.next=5,Promise.all(t.map(function(){var e=j(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(t.id);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:n=e.sent,J(t),Z(n);case 8:case"end":return e.stop()}}),e)})))(),X((function(e){return performance.now()}))}),[]),(0,i.useEffect)((function(){(0,c.clearInterval)(z),H((0,c.setInterval)((function(){T((function(e){return(e+1)%s}))}),1e3/d))}),[s,d]),(0,i.useEffect)((function(){var e=performance.now(),t=e-V;X(e),K((function(e){return.8*e+.2*t})),_%5||console.log(Q)}),[_]),(0,i.useEffect)((function(){var e=n.current;if(e&&oe){var r=t.current,o=null;o=e.getZoom()<15?5:5+e.getZoom(),e.getZoom()!=te&&(ne(e.getZoom()),r.width=o*Math.round(F[1]-F[0]),r.height=o*Math.round(C[1]-C[0])),function(e,t,n,r,o,a,i){var s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.fillStyle="#1A1C20",s.beginPath(),s.rect(0,0,1*e.width,e.height),s.globalAlpha=.4,s.fill(),s.lineWidth=4,s.strokeStyle="#364FBD";var u,c,l,f,d=new w("/car.png",1.76,2,i),h=new w("/truck_small.png",1.8,7,i),p=new w("/truck_big.png",1.85,5,i),v=new w("/pedestrian.png",.8,0,i),m=new w("/bike.png",.75,1,i),g=new w("/moto.png",1,3,i),_=new w("/logo_2.png",100,-1,50),T=[v,m,d,g,_,p,_,h,_,_];for(var x in n){var I=n[x].filter((function(e){return e.time==r}));if(I.length>0){var S=I[0],A=(S.x,S.y,S.vx),E=S.vy,j=(S.theta,S.l),P=S.w,O=(S.prob_exists,t[x].class_field),C=(t[x].ds_id,k(S.y,a[0],a[1],e.width)),F=(u=S.x,c=o[0],l=o[1],-(f=e.height)/(l-c)*(u-c)+f),D=(Math.round(i*j*2),Math.round(i*P*2),Math.atan2(A,E)+y),q=Math.sqrt(Math.pow(A,2)+Math.pow(E,2)).toFixed(0);M(s,C,F,D,b[O],T[O],q)}}}(r,L,W,_,C,F,o)}})),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{ref:e,className:"map-container"}),(0,a.jsx)("canvas",{ref:t,id:"canvasID"})]})}},7663:function(e){!function(){var t={162:function(e){var t,n,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"===typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s,u=[],c=!1,l=-1;function f(){c&&s&&(c=!1,s.length?u=s.concat(u):l=-1,u.length&&d())}function d(){if(!c){var e=i(f);c=!0;for(var t=u.length;t;){for(s=u,u=[];++l<t;)s&&s[l].run();l=-1,t=u.length}s=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new h(e,t)),1!==u.length||c||i(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}},i=!0;try{t[e](a,a.exports,r),i=!1}finally{i&&delete n[e]}return a.exports}r.ab="//";var o=r(162);e.exports=o}()},9647:function(e,t,n){var r=n(3454);!function(){var t={619:function(){!function(e,t){"use strict";if(!e.setImmediate){var n,o=1,a={},i=!1,s=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?n=function(e){r.nextTick((function(){f(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",r=function(n){n.source===e&&"string"===typeof n.data&&0===n.data.indexOf(t)&&f(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),n=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){f(e.data)},n=function(t){e.port2.postMessage(t)}}():s&&"onreadystatechange"in s.createElement("script")?function(){var e=s.documentElement;n=function(t){var n=s.createElement("script");n.onreadystatechange=function(){f(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():n=function(e){setTimeout(f,0,e)},u.setImmediate=function(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return a[o]=i,n(o),o++},u.clearImmediate=c}function c(e){delete a[e]}function l(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(undefined,n)}}function f(e){if(i)setTimeout(f,0,e);else{var t=a[e];if(t){i=!0;try{l(t)}finally{c(e),i=!1}}}}}("undefined"===typeof self?"undefined"===typeof n.g?this:n.g:self)}};"undefined"!==typeof __nccwpck_require__&&(__nccwpck_require__.ab="//");t[619](),e.exports={}}()},602:function(e,t,n){!function(){var t={832:function(e,t,r){var o="undefined"!==typeof n.g&&n.g||"undefined"!==typeof self&&self||window,a=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(a.call(setTimeout,o,arguments),clearTimeout)},t.setInterval=function(){return new i(a.call(setInterval,o,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(o,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(505),t.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof n.g&&n.g.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof n.g&&n.g.clearImmediate||this&&this.clearImmediate},505:function(e){"use strict";e.exports=n(9647)}},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var a=r[e]={exports:{}},i=!0;try{t[e].call(a.exports,a,a.exports,o),i=!1}finally{i&&delete r[e]}return a.exports}o.ab="//";var a=o(832);e.exports=a}()}},function(e){e.O(0,[634,774,888,179],(function(){return t=2211,e(e.s=t);var t}));var t=e.O();_N_E=t}]);